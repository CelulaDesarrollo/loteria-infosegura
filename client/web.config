<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <!-- 1. CORRECCIÓN DEL DOCUMENTO PREDETERMINADO -->
        <defaultDocument>
            <files>
                <!-- Removemos los defaults genéricos de IIS -->
                <remove value="iisstart.htm" />
                <remove value="Default.asp" />
                <remove value="Default.htm" />
                <!-- Y aseguramos que index.html sea el primero -->
                <add value="index.html" />
            </files>
        </defaultDocument>

        <!-- 2. REGLAS DE REESCRITURA DE URL (CRUCIAL PARA NEXT.JS SSG) -->
        <rewrite>
            <rules>
                <!-- Regla para rutas sin extensión -->
                <!-- Esta regla permite que URLs como /room/main_loteria carguen el index.html correcto -->
                <rule name="Next.js Static Paths" stopProcessing="true">
                    <match url="^(.*)/?$" ignoreCase="true" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
                        <add input="{REQUEST_URI}" pattern="\.html$" negate="true" />
                    </conditions>
                    <action type="Rewrite" url="{R:1}/index.html" />
                </rule>
            </rules>
        </rewrite>

        <!-- 3. CONFIGURACIÓN DE TIPOS MIME (Opcional, pero bueno para archivos .json) -->
        <staticContent>
            <mimeMap fileExtension=".json" mimeType="application/json" />
        </staticContent>

    </system.webServer>
</configuration>